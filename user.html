<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
      integrity="sha512-z3gLpd7yknf1YoNbCzqRKc4qyor8gaKU1qmn+CShxbuBusANI9QpRohGBreCFkKxLhei6S9CQXFEbbKuqLg0DA=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js"></script>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title></title>
    <link rel="stylesheet" href="style.css" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
      crossorigin="anonymous"
    />
  </head>
  <body>
    <nav
      class="navbar navbar-expand-lg navbar bg-primary mb-md-5 mb-3"
      data-bs-theme="bg-Light"
    >
      <div class="container-fluid">
        <a
          class="navbar-brand text-primary text-decoration-none px-3 py-1 bg-white rounded-4"
          href="./index.html"
          >AgendaAI</a
        >
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="offcanvas"
          data-bs-target="#offcanvasNavbar"
          aria-controls="offcanvasNavbar"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div
          class="offcanvas offcanvas-end"
          tabindex="-1"
          id="offcanvasNavbar"
          aria-labelledby="offcanvasNavbarLabel"
        >
          <div class="offcanvas-header bg-primary">
            <a href="./index.html" class="text-decoration-none">
              <h5
                class="offcanvas-title text-primary px-3 py-1 bg-white rounded-4"
                id="offcanvasNavbarLabel "
              >
                AgendaAI
              </h5>
            </a>
            <button
              type="button"
              class="btn-close shadow-none border-0"
              data-bs-dismiss="offcanvas"
              aria-label="Close"
            ></button>
          </div>
          <div class="offcanvas-body bg-primary">
            <ul
              id="offcanvas-nav"
              class="navbar-nav justify-content-center flex-grow-1 pe-3"
            >
              <li class="nav-item mx-2">
                <a class="nav-link text-white" href="./clinics.html"
                  ><i
                    class="fa-solid fa-hand-holding-medical mx-1"
                    style="color: #ffffff"
                  ></i
                  >Clinicas</a
                >
              </li>
            </ul>

            <!-- LOGIN -->
            <div
              id="
            nav-login"
              class="d-flex justify-content-center align-items-center gap-3"
            >
              <a
                id="login"
                href="./login.html"
                class="text-white text-decoration-none"
                ><i class="fa-solid fa-user mx-1" style="color: #ffffff"></i
                >Login</a
              >
              <a
                id="register"
                href="./register.html"
                class="text-primary text-decoration-none px-3 py-1 bg-white rounded-4"
                >Registre-se</a
              >
              <a
                href="#"
                class="text-white text-decoration-none"
                id="username"
              ></a>
            </div>
          </div>
        </div>
      </div>
    </nav>
    <main class="container-fluid align-items-center mt-lg-5 mt-3 mb-5">
      <div id="appointments" class="row justify-content-center">
        <div class="col-lg-10 col border rounded-2 p-5 shadow-lg mb-4">
          <h3 class="lead fs-3">Consultas Marcadas</h3>
          <div id="appointments-container"></div>
        </div>
      </div>
      <div id="appointment-consults" class="row justify-content-center">
        <div class="col-lg-10 col border rounded-2 p-5 shadow-lg mb-4">
          <h2 class="lead fs-3 mb-4">Agendar Consultas</h2>
          <div id="output-response"></div>
          <form id="appointment-form">
            <div class="input-group mb-5 d-none d-md-flex">
              <select
                id="physician"
                class="form-select"
                aria-label="Default Physician"
                required
              >
                <option selected>Escolha um médico</option>
                <!-- Opções preenchidas via JS -->
              </select>
              <span class="input-group-text">/</span>
              <input class="form-control" type="date" name="date" id="date" required />
              <span class="input-group-text">/</span>
              <select id="hour" class="form-select" aria-label="Default Hour" required>
                <option selected>Escolha um Horário</option>
                <option value="08:00">08:00</option>
                <option value="08:30">08:30</option>
                <option value="09:00">09:00</option>
                <option value="09:30">09:30</option>
                <option value="10:00">10:00</option>
                <option value="10:30">10:30</option>
                <option value="11:00">11:00</option>
                <option value="11:30">11:30</option>
                <option value="12:00">12:00</option>
              </select>
            </div>
            <!-- Mobile variant -->
            <select
              id="physician-mobile"
              class="form-select d-md-none mb-2"
              aria-label="Default Physician"
              required
            >
              <option selected>Escolha um médico</option>
              <!-- Opções preenchidas via JS -->
            </select>
            <input
              class="form-control d-md-none mb-2"
              type="date"
              name="date"
              id="date-mobile"
              required
            />
            <select
              id="hour-mobile"
              class="form-select d-md-none mb-2"
              aria-label="Default Hour"
              required
            >
              <option selected>Escolha um Horário</option>
              <option value="08:00">08:00</option>
              <option value="08:30">08:30</option>
              <option value="09:00">09:00</option>
              <option value="09:30">09:30</option>
              <option value="10:00">10:00</option>
              <option value="10:30">10:30</option>
              <option value="11:00">11:00</option>
              <option value="11:30">11:30</option>
              <option value="12:00">12:00</option>
            </select>
            <div class="container w-100 text-center">
              <button
                id="appointment-btn"
                class="btn btn-success text-center w-50"
                type="submit"
              >
                Agendar
              </button>
            </div>
          </form>
        </div>
      </div>
      <div class="row justify-content-center">
        <div class="col col-lg-10 border rounded-2 p-5 shadow-lg mb-5">
          <h3 class="lead fs-3">Consultas Passadas</h3>
          <div id="past-appointments"></div>
        </div>
      </div>
    </main>
    <footer class="container-fluid text-white text-center bg-primary p-1 fixed-bottom">
      <h5 class="fs-6">
        Um projeto desenvolvido pelos estudantes do curso de Sistemas de Informação, UNEX-ITABUNA.
      </h5>
    </footer>
    <script src="./js/auth.js"></script>
    <script src="./js/formatter.js"></script>
    <script>
      if (!getCookieValue("Username")) window.location.replace("./login.html");
      if (getCookieValue("Username")) {
        const title = document.querySelector("title");
        const user = getCookieValue("Username");
        title.innerText = `${user} - AgendaAI`;
        document.querySelector("#username").innerText = "Bem-vindo, " + user + "!";
        document.querySelectorAll("#register").forEach((d) => d.remove());
        document.querySelectorAll("#login").forEach((d) => d.remove());
      }
      // Logout dinâmico no menu lateral
      const offcanvasNav = document.querySelector("#offcanvas-nav");
      if (offcanvasNav && getCookieValue("Username")) {
        const liNav = document.createElement("li");
        liNav.classList.add("nav-item", "mx-2");
        const aNav = document.createElement("a");
        aNav.classList.add("nav-link", "text-white");
        aNav.style.cursor = "pointer";
        const iNav = document.createElement("i");
        iNav.classList.add("fa-solid", "fa-right-from-bracket", "mx-1");
        aNav.appendChild(iNav);
        aNav.appendChild(document.createTextNode("Logout"));
        aNav.addEventListener("click", () => {
          if (typeof logoutUser === "function") {
            logoutUser();
          } else {
            // fallback caso o script não tenha carregado
            const cookiesToRemove = ["Session", "Username", "Email"];
            cookiesToRemove.forEach(cookieName => {
              document.cookie = `${cookieName}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;`;
              document.cookie = `${cookieName}=; expires=Thu, 01 Jan 1970 00:00:00 UTC;`;
            });
            window.location.href = "./index.html";
          }
        });
        liNav.appendChild(aNav);
        offcanvasNav.appendChild(liNav);
      }
    </script>
  </body>
</html>
